---
import products from "../data/products.json";
import { Image } from "astro:assets";
import logo from "../assets/images/floor-boss-icon.jpg";

const WHATSAPP_NUMBER = "+2349165208580"; // IMPORTANT: Replace with your actual WhatsApp number
const PHONE_NUMBER = "+2349165208580"; // IMPORTANT: Replace with your actual Phone number

const allCategories = [...new Set(products.map((p) => p.category))]

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  canonicalURL?: string;
}

const { title, description, ogImage, canonicalURL } = Astro.props;

const defaultDescription =
  "Discover Nigeria's finest collection of SPC, vinyl, and luxury flooring solutions from FLOOR BOSS ng, based in Abuja. Quality floors for homes and offices.";
const defaultOgImage = "/images/floorboss-og.jpg"; // You'll need to create this image
const currentURL = canonicalURL || Astro.url.href;
const siteName = "FLOOR BOSS ng";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description || defaultDescription} />
    <link rel="canonical" href={currentURL} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={currentURL} />
    <meta property="og:title" content={title} />
    <meta
      property="og:description"
      content={description || defaultDescription}
    />
    <meta property="og:image" content={ogImage || defaultOgImage} />
    <meta property="og:site_name" content={siteName} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={currentURL} />
    <meta property="twitter:title" content={title} />
    <meta
      property="twitter:description"
      content={description || defaultDescription}
    />
    <meta property="twitter:image" content={ogImage || defaultOgImage} />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Space Grotesk", sans-serif;
      }
    </style>
  </head>
  <body class="bg-[var(--brand-cream)] text-[var(--brand-ink)]">
    <header class="bg-white/95 backdrop-blur shadow-md sticky top-0 z-50">
      <nav
        class="container mx-auto px-6 py-4 flex justify-between items-center"
      >
        <a href="/" class="flex items-center gap-3">
          <Image
            src={logo}
            alt="FLOOR BOSS ng"
            class="w-12 h-12 rounded-xl object-cover shadow-sm border border-stone-200"
            width={96}
            height={96}
            loading="eager"
            decoding="async"
            fetchpriority="high"
          />
          <span class="text-xl font-black tracking-wider text-[var(--brand-ink)]">
            FLOOR<span class="text-[var(--brand-orange)]">BOSS</span>
          </span>
        </a>

        <!-- Desktop Menu -->
        <div class="hidden md:flex items-center space-x-6">
          <a href="/" class="font-bold text-stone-600 hover:text-[var(--brand-ink)]"
            >Home</a
          >
          {
            allCategories.map((category) => (
              <a
                href={`/${category}`}
                class="font-bold text-stone-600 hover:text-[var(--brand-ink)] uppercase"
              >
                {category}
              </a>
            ))
          }
          <a href="/cart" class="font-bold text-stone-600 hover:text-[var(--brand-ink)]"
            >Cart</a
          >
        </div>

        <!-- Mobile Menu Button -->
        <div class="md:hidden">
          <button
            id="mobile-menu-button"
            class="text-stone-800 focus:outline-none"
            aria-expanded="false"
            aria-controls="mobile-menu"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
          </button>
        </div>
      </nav>

      <!-- Mobile Menu -->
      <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
        <a href="/" class="block py-2 px-4 text-sm hover:bg-stone-100">Home</a>
        {
          allCategories.map((category) => (
            <a
              href={`/${category}`}
              class="block py-2 px-4 text-sm hover:bg-stone-100 capitalize"
            >
              {category}
            </a>
          ))
        }
        <a href="/cart" class="block py-2 px-4 text-sm hover:bg-stone-100"
          >Cart</a
        >
      </div>
    </header>

    <main>
      <slot />
    </main>

    <!-- Floating Buttons -->
    


    <a
      href={`tel:${PHONE_NUMBER}`}
      class="fixed bottom-24 md:bottom-6 left-6 bg-[var(--brand-orange)] text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center hover:bg-[var(--brand-orange-dark)] transition-transform hover:scale-110 z-50"
      aria-label="Call FLOOR BOSS ng"
    >
      <svg
        class="w-7 h-7"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <path
          d="M22 16.92v3a2 2 0 0 1-2.18 2A19.8 19.8 0 0 1 3 5.18 2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.72c.12.81.3 1.6.54 2.36a2 2 0 0 1-.45 2.11L9 10a16 16 0 0 0 5 5l.81-1.09a2 2 0 0 1 2.11-.45c.76.24 1.55.42 2.36.54A2 2 0 0 1 22 16.92z"
        />
      </svg>
    </a>

    <a
      href="/cart"
      class="fixed bottom-24 md:bottom-6 right-6 bg-[var(--brand-ink)] text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center hover:bg-black transition-transform hover:scale-110 z-50"
      aria-label="Open cart"
    >
      <svg
        class="w-7 h-7"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <circle cx="9" cy="21" r="1" />
        <circle cx="20" cy="21" r="1" />
        <path d="M1 1h4l2.7 13.4a2 2 0 0 0 2 1.6h8.8a2 2 0 0 0 2-1.6L23 6H6" />
      </svg>
    </a>

    <footer class="text-center py-8 mt-12 bg-white border-t">
      <p>
        &copy; {new Date().getFullYear()} FLOOR BOSS ng. All Rights Reserved.
      </p>
      <p class="text-sm text-stone-500">
        Your Trusted Partner for Quality Floors in Abuja.
      </p>
    </footer>

    <!-- Toast Notification -->
    <div
      id="toast-notification"
      class="fixed bottom-16 left-1/2 -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-lg shadow-xl z-[9999] opacity-0 transition-opacity duration-300 pointer-events-none"
    >
      Item added to cart!
    </div>

    <style is:global>
      :root {
        --brand-ink: #1f2a2e;
        --brand-ink-soft: #2d3a40;
        --brand-orange: #f06a2b;
        --brand-orange-dark: #d8581f;
        --brand-cream: #f6f2ea;
      }

      /* Glowing border effect */
      body.glowing-border {
        outline: 4px solid var(--brand-orange);
        outline-offset: -4px;
        transition: outline 0.3s ease-out;
      }
    </style>

    <script type="module">
      import { addToCart } from "../lib/cart.js";

      function initPage() {
        function updateCartButtons() {
          const cart = JSON.parse(localStorage.getItem("cart")) || [];
          const ids = new Set(cart.map((item) => item.id));
          document
            .querySelectorAll("button[data-product-id]")
            .forEach((button) => {
              const id = parseInt(button.dataset.productId);
              if (ids.has(id)) {
                button.textContent = "In Cart";
                button.classList.add("opacity-90");
              } else {
                button.textContent = "Add to Cart";
                button.classList.remove("opacity-90");
              }
            });
        }

        // Add to cart logic (event delegation)
        if (!window.__cartListenerAttached) {
          document.addEventListener("click", (event) => {
            const button = event.target.closest("button[data-product-id]");
            if (!button) return;

            event.preventDefault();
            const id = parseInt(button.dataset.productId);
            const name = button.dataset.productName;
            const price = parseFloat(button.dataset.productPrice);
            const image = button.dataset.productImage;
            addToCart(id, name, price, image);
            updateCartButtons();
          });
          window.__cartListenerAttached = true;
        }

        // Mobile menu toggle logic
        const mobileMenuButton = document.getElementById("mobile-menu-button");
        const mobileMenu = document.getElementById("mobile-menu");
        if (mobileMenuButton && mobileMenu && !mobileMenuButton.dataset.bound) {
          mobileMenuButton.addEventListener("click", () => {
            const isOpen = !mobileMenu.classList.contains("hidden");
            mobileMenu.classList.toggle("hidden");
            mobileMenuButton.setAttribute(
              "aria-expanded",
              String(!isOpen),
            );
          });

          mobileMenu.querySelectorAll("a").forEach((link) => {
            link.addEventListener("click", () => {
              mobileMenu.classList.add("hidden");
              mobileMenuButton.setAttribute("aria-expanded", "false");
            });
          });

          document.addEventListener("click", (event) => {
            if (
              mobileMenu.classList.contains("hidden") ||
              mobileMenuButton.contains(event.target) ||
              mobileMenu.contains(event.target)
            ) {
              return;
            }
            mobileMenu.classList.add("hidden");
            mobileMenuButton.setAttribute("aria-expanded", "false");
          });

          mobileMenuButton.dataset.bound = "true";
        }

        updateCartButtons();
      }

      // Run on initial page load and also after client-side navigation
      document.addEventListener("DOMContentLoaded", initPage);
      document.addEventListener("astro:after-swap", initPage);
    </script>
  </body>
</html>
